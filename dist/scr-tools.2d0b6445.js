parcelRequire=function(e,r,t,n){var i,o="function"==typeof parcelRequire&&parcelRequire,u="function"==typeof require&&require;function f(t,n){if(!r[t]){if(!e[t]){var i="function"==typeof parcelRequire&&parcelRequire;if(!n&&i)return i(t,!0);if(o)return o(t,!0);if(u&&"string"==typeof t)return u(t);var c=new Error("Cannot find module '"+t+"'");throw c.code="MODULE_NOT_FOUND",c}p.resolve=function(r){return e[t][1][r]||r},p.cache={};var l=r[t]=new f.Module(t);e[t][0].call(l.exports,p,l,l.exports,this)}return r[t].exports;function p(e){return f(p.resolve(e))}}f.isParcelRequire=!0,f.Module=function(e){this.id=e,this.bundle=f,this.exports={}},f.modules=e,f.cache=r,f.parent=o,f.register=function(r,t){e[r]=[function(e,r){r.exports=t},{}]};for(var c=0;c<t.length;c++)try{f(t[c])}catch(e){i||(i=e)}if(t.length){var l=f(t[t.length-1]);"object"==typeof exports&&"undefined"!=typeof module?module.exports=l:"function"==typeof define&&define.amd?define(function(){return l}):n&&(this[n]=l)}if(parcelRequire=f,i)throw i;return f}({"L89o":[function(require,module,exports) {
"use strict";function e(e,r){e.ondragover=(()=>!1),e.ondragend=(()=>!1),e.addEventListener("drop",t=>{t.preventDefault(),t.stopPropagation(),console.log("on ",e);const o=t.dataTransfer.files[0],n=new FileReader;n.onload=(e=>{r(new Uint8Array(e.target.result))}),n.readAsArrayBuffer(o)},!1)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=e;
},{}],"qOPc":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.normalColours=exports.brightColours=exports.normalColoursLookup=exports.brightColoursLookup=void 0;const t=new Map;exports.brightColoursLookup=t,t.set([0,0,0].toString(),0),t.set([0,0,255].toString(),1),t.set([255,0,0].toString(),2),t.set([255,0,255].toString(),3),t.set([0,255,0].toString(),4),t.set([0,255,255].toString(),5),t.set([255,255,0].toString(),6),t.set([255,255,255].toString(),7);const o=new Map;exports.normalColoursLookup=o,o.set([0,0,0].toString(),0),o.set([0,0,215].toString(),1),o.set([215,0,0].toString(),2),o.set([215,0,215].toString(),3),o.set([0,215,0].toString(),4),o.set([0,215,215].toString(),5),o.set([215,215,0].toString(),6),o.set([215,215,215].toString(),7);const r={0:[0,0,0],1:[0,0,255],2:[255,0,0],3:[255,0,255],4:[0,255,0],5:[0,255,255],6:[255,255,0],7:[255,255,255]};exports.brightColours=r;const s={0:[0,0,0],1:[0,0,215],2:[215,0,0],3:[215,0,215],4:[0,215,0],5:[0,215,215],6:[215,215,0],7:[215,215,215]};exports.normalColours=s;
},{}],"jTIM":[function(require,module,exports) {
"use strict";function t(t,e,s){return t*s+e}Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;let e=1;class s{constructor(t,s=document.body,i){if(this.target=s,this.order=e++,this.id=i||`zoom-${this.order}`,t instanceof HTMLImageElement){const e=t,i=document.createElement("canvas");s.appendChild(i),i.width=e.width,i.height=e.height,(t=i.getContext("2d")).drawImage(e,0,0),e.parentNode.replaceChild(i,e)}if(t instanceof CanvasRenderingContext2D){const e=this.sourceCtx=t;this.buffer=t.getImageData(0,0,t.canvas.width,t.canvas.height).data,e.canvas.toBlob(s=>{const i=URL.createObjectURL(s);e.canvas.style.background=`url(${i}) no-repeat`,e.clearRect(0,0,t.canvas.width,t.canvas.height)})}else this.buffer=t instanceof ImageData?t.data:t;this.isVisible=!1,this._last=null}makeVisible(t=this.target){const e=document.createElement("canvas");e.className="zoom",e.id=this.id,t.appendChild(e),this.ctx=e.getContext("2d");const s=e.width=8,i=e.height=8;return e.style.imageRendering="pixelated",e.style.width=`${20*s}px`,e.style.height=`${20*i}px`,e.style.setProperty("--order",this.order),this.isVisible=!0,this}put(t){this.ctx.putImageData(t,0,0)}seeXY(t,e){const s=`${t}x${e}`;if(s===this._last)return;this._last=s,this.isVisible||this.makeVisible();const i=new ImageData(this.pixel(t,e),8,8);if(this.ctx.putImageData(i,0,0),this.sourceCtx){const s=this.sourceCtx;s.clearRect(0,0,s.canvas.width,s.canvas.height),s.strokeStyle="white",s.strokeRect(8*t+.5,8*e+.5,8,8),s.strokeStyle="black",s.strokeRect(8*t-.5,8*e-.5,8,8)}}pixel(e=0,s=0){const i=this.buffer,a=new Uint8ClampedArray(256);for(let n=0;n<8;n++){const r=t(256,8*e,8*s+n),c=4*r,o=c+32,h=8*n*4;0,a.set(i.slice(c,o),h)}return a}}exports.default=s;
},{}],"Jezl":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.load=s,exports.stream=u,exports.pixelsForSCR=p,exports.loadBlinkAttributes=f,exports.default=g,exports.blink=d,exports.readAttributes=x,exports.pixelsToBytes=w,exports.putPixels=m,exports.getInkFromPixel=v,exports.attributesForBlock=$,exports.putAttributes=I,exports.download=j;var t=require("./zx-colour.js"),e=n(require("./Zoom.js"));function n(t){return t&&t.__esModule?t:{default:t}}let r=[],o=!1;function a(t=0,e=0,n,r=n.subarray(6144)[32*e+t]){const o=2048*(e/8|0),a=n.subarray(o,o+2048),{ink:s,paper:i}=x(r),l=new Uint8ClampedArray(256);e%=8;for(let c=0;c<8;c++){const n=a[t+256*c+32*e];for(let t=0;t<8;t++){const e=0==(n&1<<7-t)?i:s,r=4*t+32*c;l[r+0]=e[0],l[r+1]=e[1],l[r+2]=e[2],l[r+3]=255}}return l}async function s(t){return new Uint8Array(await(await fetch(t)).arrayBuffer())}async function i(t){if(t)return new Promise(e=>setTimeout(()=>e(),t))}async function l(t,e,n,r){t.putImageData(e,n,r),await i(0)}async function c(t,e,n){const r=new Uint8ClampedArray(32);let o=0;for(let a=0;a<8;a++)for(let s=0;s<8;s++)for(let i=0;i<32;i++){let c=0;const u=n[o++];for(;c<8;c++){const t=0==(u&1<<7-c)?0:255,e=4*c;r[e+0]=t,r[e+1]=t,r[e+2]=t,r[e+3]=255}const p=8*i,f=t.canvas.height/3*e+8*s+a;await l(t,new ImageData(r,8,1),p,f)}}async function u(t,e,n){const o=n>>11;if(3===o){const o=x(e),a=n%32*8,s=(n>>5)%64*8,i=t.getImageData(a,s,8,8);for(let t=0;t<64;t++){const e=255===i.data[4*t]?"ink":"paper";i.data.set(o[e],4*t)}return o.blink&&o.ink!==o.paper&&r.push({attribute:e,x:a/8,y:s/8}),void(await l(t,i,a,s))}const a=new Uint8ClampedArray(32);for(let r=7;r>=0;r--){const t=0==(e&1<<r)?0:255;a.set([t,t,t,255],4*(7-r))}const s=n%32,i=8*(n>>5)%64+56*o,c=n>>8;l(t,new ImageData(a,8,1),8*s,i+c)}function p(t,e){const n=new Uint8ClampedArray(196608);for(let r=0;r<24;r++)for(let n=0;n<32;n++){const o=a(n,r,t);e.putImageData(new ImageData(o,8,8),8*n,8*r)}return n}function f(t,e){r=[];for(let o=6144;o<=6912;o++){const e=t[o],{ink:n,paper:a,blink:s}=x(e);if(s&&n.join("")!==a.join("")){const t=o%32,n=(o>>5)%64;r.push({attribute:e,i:o,x:t,y:n})}}let n=null;return{start:()=>{n=setInterval(()=>b(e,t),333)},stop:()=>clearInterval(n)}}async function y(t,e){const n=e.subarray(6144);for(let o=0;o<n.length;o++){const s=n[o],{ink:i,paper:c,blink:u}=x(s),p=o%(t.canvas.width/8),f=o/(t.canvas.width/8)|0,y=new ImageData(a(p,f,e),8,8);u&&i.join("")!==c.join("")&&r.push({attribute:s,x:p,y:f}),await l(t,y,8*p,8*f)}}function b(t,e){o=!o,r.forEach(n=>{const{x:r,y:s}=n;let i=n.attribute;o&&(i=(192&i)+((7&i)<<3)+((56&i)>>3));const c=new ImageData(a(r,s,e,i),8,8);l(t,c,8*r,8*s)})}async function g(t){const n=await s(t||"./screens/remy.scr"),o=document.createElement("canvas"),a=document.createElement("pre");document.body.appendChild(o);const i=new e.default(n);document.body.appendChild(a);const l=o.getContext("2d");window.ctx=l;const u=o.width=256,p=o.height=192;o.style.imageRendering="pixelated",o.style.width=`${2*u}px`,o.style.height=`${2*p}px`,l.fillStyle="#ccc",l.fillRect(0,0,u,p),await c(l,0,n.subarray(0,2048)),await c(l,1,n.subarray(2048,4096)),await c(l,2,n.subarray(4096,6144));const f=n.subarray(6144);await y(l,n),i.seeXY(0,0),o.onmousemove=(t=>{const{ptr:e,x:n,y:r,byte:o,bright:s,blink:l,ink:c,paper:u}=k({attribs:f,scale:2,x:t.pageX,y:t.pageY});i.seeXY(n/8,r/8),a.innerHTML=`ptr: ${e}\nx: ${n} (${n/8})\ny: ${r} (${r/8})\nbyte: ${o}\nink: <span style="color: white; text-shadow: 1px 1px 0 #000; background: rgb(${c.join(",")})">${(7&o).toString(2).padStart(3,"0")}</span>\npaper: <span style="color: white; text-shadow: 1px 1px 0 #000; background: rgb(${u.join(",")})">${((56&o)>>3).toString(2).padStart(3,"0")}</span>\nbright: ${s}\nblink: ${l}\n`}),o.onclick=(t=>{const{x:e,y:n,ink:o,paper:a}=k({attribs:f,scale:2,x:t.pageX,y:t.pageY});r.push({x:e,y:n,ink:o,paper:a})}),setInterval(()=>b(l,n),333)}function d(t,e){return setInterval(()=>b(t,e),333)}function x(e){const n=!!(64&e),r=n?t.brightColours:t.normalColours,o={ink:7&e,paper:(56&e)>>3};return{values:o,bright:n,ink:r[o.ink],paper:r[o.paper],blink:!!(128&e)}}function k({x:t,y:e,scale:n=1,attribs:r=[]}){const o=32*(e=(e/n|0)/8|0)+(t=(t/n|0)/8|0),a=r[o],{ink:s,paper:i,bright:l,blink:c}=x(a);return{ptr:o,x:8*t,y:8*e,byte:a,ink:s,paper:i,blink:c,bright:l}}function h(t,e,n){return t*n+e}function w(t,e,n){const r=e.subarray(2048*t,2048*(t+1)),o=n.subarray(t*(n.length/3),(t+1)*(n.length/3));let a=0;for(let s=0;s<8;s++)for(let t=0;t<8;t++){const e=8*t+s;for(let t=0;t<32;t++){let n=0;for(let r=0;r<8;r++){n+=(0===o[4*h(256,8*t+r,e)]?1:0)<<7-r}r[a]=n,a++}}}function m(t,e,n){const r=e.subarray(2048*t,2048*(t+1)),o=n.subarray(t*(n.length/3),(t+1)*(n.length/3));let a=0;for(let s=0;s<8;s++)for(let t=0;t<8;t++){const e=8*t+s;for(let t=0;t<32;t++){let n=0;for(let r=0;r<8;r++){n+=(0===o[4*h(256,8*t+r,e)]?1:0)<<7-r}r[a]=n,a++}}}function v(e,n=!1){e=`${e[0]},${e[1]},${e[2]}`;let r=t.brightColoursLookup.get(e);return r||(r=t.normalColoursLookup.get(e),n&&(r<<=3)),r}function $(t,e){let n=0;const r=new Uint8Array(57).fill(0);for(let s=0;s<t.length/4;s++){const e=v([...t.slice(4*s,4*s+3)],!0);r[e]++}e&&Object.keys(r).forEach((t,e)=>r[e]&&console.log("ink %s (%s)",t,r[e]));let[{ink:o},{ink:a}={ink:0}]=Array.from(r).map((t,e)=>({ink:e,count:t})).filter(({count:t})=>t).sort((t,e)=>t.count-e.count).slice(-2);if(null===o&&(o=a),7===a&&7!==o&&([a,o]=[o,a]),a>>3==0||o>>3==0)if(0===a||0===o){(0===a?o:a)>>>3==0&&(n+=64)}else e&&console.log("dealing with bright"),a>>3==0&&r[a]>r[o]?(e&&console.log("ink > paper",a,o),n+=64):o>>3==0&&r[o]>r[a]&&(e&&console.log("paper > ink"),n+=64);return a>>3!=0&&(a>>=3),o>>3!=0&&(o>>=3),n+=o<<3,n+=a}function I(t,n){let r=0;const o=new e.default(n);for(let e=0;e<24;e++)for(let n=0;n<32;n++){const a=o.pixel(n,e),s=!1;t[6144+r]=$(a,s),r++}}function j(t,e="image.png",n="image/png"){const r=document.createElement("a");r.download=e;const o=new Blob([t],{type:n}),a=URL.createObjectURL(o);var s,i;r.href=a,s=r,i=new MouseEvent("click"),s.dispatchEvent(i),URL.revokeObjectURL(a)}
},{"./zx-colour.js":"qOPc","./Zoom.js":"jTIM"}],"FfSr":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.$=void 0;class e extends Array{constructor(){return super(),new Proxy(this,{set(e,t,r){const s=e[0];return s&&t in s?e.filter(e=>e[t]=r):this[t]=r}})}on(e,t,r){return this.filter(s=>s.addEventListener(e,t,r))}emit(e,t){const r=new Event(e,{data:t});return this.filter(e=>e.dispatchEvent(r))}}const t=(t,r=document)=>{const s=r.querySelectorAll(t);return 0===s.length&&console.warn(`${t} zero results`),e.from(s)};exports.$=t;
},{}],"iWCo":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=function(){var e=document.createElement("a");return document.body.appendChild(e),e.style="display: none",function(t,o){let r=null;t instanceof Blob?r=t:(Array.isArray(t)||(t=[t]),r=new Blob(t,{type:"octet/stream"}));const n=URL.createObjectURL(r);e.href=n,e.download=o,e.click(),URL.revokeObjectURL(n)}}();exports.default=e;
},{}],"JFDb":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var r={oneDimensional:[{x:1,y:0,factor:1}],floydSteinberg:[{x:1,y:0,factor:7/16},{x:-1,y:1,factor:3/16},{x:0,y:1,factor:5/16},{x:1,y:1,factor:1/16}],jarvisJudiceNinke:[{x:1,y:0,factor:7/48},{x:2,y:0,factor:5/48},{x:-2,y:1,factor:3/48},{x:-1,y:1,factor:5/48},{x:0,y:1,factor:7/48},{x:1,y:1,factor:5/48},{x:2,y:1,factor:3/48},{x:-2,y:2,factor:1/48},{x:-1,y:2,factor:3/48},{x:0,y:2,factor:5/48},{x:1,y:2,factor:3/48},{x:2,y:2,factor:1/48}],stucki:[{x:1,y:0,factor:8/42},{x:2,y:0,factor:4/42},{x:-2,y:1,factor:2/42},{x:-1,y:1,factor:4/42},{x:0,y:1,factor:8/42},{x:1,y:1,factor:4/42},{x:2,y:1,factor:2/42},{x:-2,y:2,factor:1/42},{x:-1,y:2,factor:2/42},{x:0,y:2,factor:4/42},{x:1,y:2,factor:2/42},{x:2,y:2,factor:1/42}],atkinson:[{x:1,y:0,factor:1/8},{x:2,y:0,factor:1/8},{x:-1,y:1,factor:1/8},{x:0,y:1,factor:1/8},{x:1,y:1,factor:1/8},{x:0,y:2,factor:1/8}],burkes:[{x:1,y:0,factor:.25},{x:2,y:0,factor:.125},{x:-2,y:1,factor:2/32},{x:-1,y:1,factor:.125},{x:0,y:1,factor:.25},{x:1,y:1,factor:.125},{x:2,y:1,factor:2/32}],sierra3:[{x:1,y:0,factor:5/32},{x:2,y:0,factor:3/32},{x:-2,y:1,factor:2/32},{x:-1,y:1,factor:.125},{x:0,y:1,factor:5/32},{x:1,y:1,factor:.125},{x:2,y:1,factor:2/32},{x:-1,y:2,factor:2/32},{x:0,y:2,factor:3/32},{x:1,y:2,factor:2/32}],sierra2:[{x:1,y:0,factor:.25},{x:2,y:0,factor:3/16},{x:-2,y:1,factor:1/16},{x:-1,y:1,factor:.125},{x:0,y:1,factor:3/16},{x:1,y:1,factor:.125},{x:2,y:1,factor:1/16}],sierraLite:[{x:1,y:0,factor:.5},{x:-1,y:1,factor:.25},{x:0,y:1,factor:.25}],none:[]};exports.default=r;
},{}],"yUSK":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var e=t(require("./matrices.js"));function t(e){return e&&e.__esModule?e:{default:e}}const r=[[0,0,255],[255,0,0],[255,0,255],[0,255,0],[0,255,255],[255,255,0],[255,255,255],[0,0,0],[0,0,215],[215,0,0],[215,0,215],[0,215,0],[0,215,215],[215,215,0],[215,215,215]];function n(e,t){const r=e[0]-t[0],n=e[1]-t[1],s=e[2]-t[2];return r*r+n*n+s*s}function s(e){let t,s;s=-1,t=Number.MAX_SAFE_INTEGER;for(let o=0;o<r.length;o++){const l=n(e,r[o]);l<t&&(s=o,t=l)}return[...r[s],255]}const o={step:4,channels:4,diffusionFactor:.9,clip:()=>{},findColor:s,matrix:e.default.floydSteinberg};class l{constructor(e){this.options={...o,...e}}static get defaultFindColor(){return s}static get matrices(){return e.default}dither(e,t,r={}){let n,s,o,l,a;const u={...this.options,...r},c=[];for(n=s=0,o=e.length;0<=o?s<=o:s>=o;n=0<=o?++s:--s)c.push(e[n]);const i=e.length/(u.channels*t),f=[];for(a=0;a<i;){for(l=0;l<t;)this.handlePixel(l,a,c,f,t,u),l+=u.step;a+=u.step}return f}calculateIndex(e,t,r,n){return n*e+n*t*r}handlePixel(e,t,r,n,s,o){var l,a,u,c,i,f,h,p,d;for(a=this.calculateIndex(e,t,s,o.channels),l=[],u=c=0,p=o.channels;0<=p?c<p:c>p;u=0<=p?++c:--c)l.push(r[a+u]);for(f=o.findColor(l),h=[],u=i=0,d=o.channels;0<=d?i<d:i>d;u=0<=d?++i:--i)h[u]=(r[a+u]-f[u])*o.diffusionFactor;return this.diffuseError(r,h,e,t,s,o),this.applyNewColor(n,s,f,a,o)}diffuseError(e,t,r,n,s,o){var l,a,u,c,i,f,h,p,d;for(d=[],c=0,f=(h=o.matrix).length;c<f;c++){for(a=h[c],u=this.calculateIndex(r+o.step*a.x,n+o.step*a.y,s,o.channels),l=i=0,p=o.channels;0<=p?i<p:i>p;l=0<=p?++i:--i)e[u+l]+=a.factor*t[l];d.push(o.clip(e,u))}return d}applyNewColor(e,t,r,n,s){var o,l,a,u,c,i,f;for(f=[],l=c=0,i=s.step;0<=i?c<i:c>i;l=0<=i?++c:--c)f.push(function(){var c,i,f;for(f=[],a=c=0,i=s.step;0<=i?c<i:c>i;a=0<=i?++c:--c)o=n+s.channels*l+s.channels*t*a,f.push(function(){var t,n,l;for(l=[],u=t=0,n=s.channels;0<=n?t<n:t>n;u=0<=n?++t:--t)l.push(e[o+u]=r[u]);return l}());return f}());return f}}exports.default=l;
},{"./matrices.js":"JFDb"}],"yrrh":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=n,exports.contrast=i,exports.threshold=o,exports.invertPotentialInk=r,exports.imageToCanvas=s,exports.imageToPixels=a,exports.imageToBlob=c,exports.fileToBinary=d;var t=e(require("./Zoom.js"));function e(t){return t&&t.__esModule?t:{default:t}}function n(t){return c(t).then(d)}function i(t,e=50){const n=t.data,i=128*(1-(e=e/100+1));for(let o=0;o<n.length;o+=4)n[o]=n[o]*e+i,n[o+1]=n[o+1]*e+i,n[o+2]=n[o+2]*e+i;return t}function o(t,e,n=e){for(let i=0;i<t.length;i+=4){const e=.2126*t[i]+.7152*t[i+1]+.0722*t[i+2]>=n?255:0;t[i]=t[i+1]=t[i+2]=e}return r(t),t}function r(e){const n=new t.default(e);for(let t=0;t<24;t++)for(let e=0;e<32;e++){const i=n.pixel(e,t);let o=0;for(let t=0;t<256;t+=4)0===i[t]&&(o+=1);if(o<32)for(let t=0;t<256;t+=4){const e=0===i[t]?255:0;i[t]=i[t+1]=i[t+2]=e}}return e}function h(t={width:0,height:0},e={width:0,height:0}){let n=0,i=0,o="width",r="height";e.width<e.height&&([o,r]=[r,o]);const h=t[o]/e[o],s=e.width*h|0,a=e.height*h|0;return"height"===o?n=(t[r]-s)/2:i=(t[r]-a)/2,{x:n,y:i,width:s,height:a}}function s(t,e={width:t.width,height:t.height}){const n=document.createElement("canvas");n.style.imageRendering="pixelated";const i=n.getContext("2d");n.width=e.width,n.height=e.height;const{x:o,y:r,height:s,width:a}=h(t,n);return i.drawImage(t,o,r,a,s,0,0,n.width,n.height),i}function a(t,e){const n=s(t,e);return n.getImageData(0,0,n.canvas.width,n.canvas.height)}async function c(t,e=s(t)){return new Promise(t=>{e.canvas.toBlob(e=>t(e))})}function d(t){return new Promise(e=>{const n=new window.FileReader;n.onloadend=(()=>e(new Uint8Array(n.result))),n.readAsArrayBuffer(t)})}
},{"./Zoom.js":"jTIM"}],"axyq":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.dither=o,exports.default=r;var e=i(require("./Dither.js")),a=i(require("./Zoom.js")),t=require("./image.js"),n=require("./scr.js");function i(e){return e&&e.__esModule?e:{default:e}}async function o({url:a,all:i=!1,debug:o=!1}){const s=new Image;s.crossOrigin="anonymous",s.src=a,await new Promise((e,a)=>{s.onload=e,s.onerror=a}),o&&document.body.appendChild(s);const r=(0,t.imageToCanvas)(s,{width:256,height:192}),d=r.canvas,u=d.width,p=d.height;o&&document.body.appendChild(d);const m=document.createElement("canvas").getContext("2d");m.canvas.width=u,m.canvas.height=p,o&&document.body.appendChild(m.canvas);const g=new e.default({matrix:e.default.matrices.none,step:1}),{imageData:h}=await c(r,m,g,{diffusionFactor:.1,matrix:e.default.matrices.atkinson}),{imageData:w}=await l(m,m),f=new Uint8Array(6912);return(0,n.putPixels)(0,f,w.data),(0,n.putPixels)(1,f,w.data),(0,n.putPixels)(2,f,w.data),(0,n.putAttributes)(f,h),i?{pixels:f,inkData:h,pixelData:w,originalData:r.getImageData(0,0,u,p)}:f}async function s(e){const a=document.createElement("canvas").getContext("2d"),t=a.canvas;t.width=256,t.height=192,a.putImageData(e,0,0);const n=t.toDataURL("image/png"),i=new Image;return i.src=n,new Promise(e=>i.onload=(()=>e(i)))}async function r(e=`https://twivatar.glitch.me/${prompt("Give me a twitter handle:")}`){const{pixels:t,inkData:i,pixelData:r,originalData:c}=await o(e,!0),d=new Blob([t],{"content-type":"application/binary"}),l=URL.createObjectURL(d),u=document.createElement("div");document.body.appendChild(u);const p=document.createElement("canvas").getContext("2d");p.canvas.width=256,p.canvas.height=192,u.appendChild(p.canvas),(0,n.pixelsForSCR)(t,p);const m=document.createElement("ul");m.innerHTML=`<li><a href="${l}" download="image.scr">Download .SCR file</a></li>`;const g=document.createElement("li");m.appendChild(g);const h=document.createElement("li");m.appendChild(h),document.body.appendChild(m);const w=await s(c);u.appendChild(w);const f=await s(i);u.appendChild(f);const v=await s(r);u.appendChild(v);const b=new a.default(w),y=new a.default(v),D=new a.default(f),x=new a.default(p),C=document.querySelector("canvas");C.classList.add("crosshair");let k=!0;C.onclick=(()=>{k=!k}),C.onmousemove=(e=>{if(!k)return;const a=e.pageX/8|0,t=e.pageY/8|0;x.seeXY(a,t),b.seeXY(a,t),D.seeXY(a,t),y.seeXY(a,t),g.innerHTML=`{ x: ${a}, y: ${t} }`;const i=D.pixel(a,t),o=(0,n.attributesForBlock)(i);window.attributesForBlock=n.attributesForBlock.bind(null,i);const s=18===t&&20===a,r=(0,n.readAttributes)(o,s),c=r.ink.join(","),d=r.paper.join(",");h.innerHTML=`ink: ${c} (${r.values.ink}) <span class="block" style="background: rgb(${c})"></span>, paper: ${d} (${r.values.paper}) <span class="block" style="background: rgb(${d})"></span>`})}async function c(e,a,n,i={}){const o=e.canvas.width,s=e.canvas.height,r=(0,t.contrast)(e.getImageData(0,0,o,s),10),c=n.dither(r.data,o,i),d=new ImageData(new Uint8ClampedArray(c),o,s);return a.putImageData(d,0,0),{imageData:d}}function d(e,a,t,i=new Uint8ClampedArray(256)){const o=e.pixel(a,t),s=3===a&&1===t,r=(0,n.attributesForBlock)(o,s),c=(0,n.readAttributes)(r);s&&console.log(c);for(let d=0;d<64;d++){const e=(0,n.getInkFromPixel)([...o.slice(4*d,4*d+3)]);e===c.values.ink?i.set([0,0,0,255],4*d):e===c.values.paper?i.set([255,255,255,255],4*d):i.set([0,0,0,255],4*d)}return i}async function l(e,t){const n=e.canvas.width,i=e.canvas.height,o=e.getImageData(0,0,n,i),s=new a.default(o.data),r=new Uint8ClampedArray(256);for(let a=0;a<24;a++)for(let e=0;e<32;e++)d(s,e,a,r),t.putImageData(new ImageData(r,8,8),8*e,8*a);return{imageData:t.getImageData(0,0,n,i)}}window.location.search.includes("retrofy")&&r();
},{"./Dither.js":"yUSK","./Zoom.js":"jTIM","./image.js":"yrrh","./scr.js":"Jezl"}],"w5Xh":[function(require,module,exports) {
"use strict";var e=i(require("../lib/dnd.js")),t=require("./lib/scr.js"),n=require("../lib/$.js"),r=i(require("../lib/save.js")),o=require("./lib/retrofy.js");function i(e){return e&&e.__esModule?e:{default:e}}const c=(0,n.$)("#result")[0];function s(e){return e.split(".").slice(0,-1).join(".")}function a(e,t){const n=e.toUpperCase().endsWith(".SCR"),o=document.createElement("canvas");o.width=256,o.height=192;const i=o.getContext("2d"),a=document.createElement("div");a.className="container",a.appendChild(o);const l=document.createElement("button");if(a.appendChild(l),l.onclick=(async()=>{const t=await new Promise(e=>o.toBlob(e));(0,r.default)(t,s(e)+".png")}),l.innerText="Download PNG",!n){const n=document.createElement("button");a.appendChild(n),n.onclick=(async()=>{(0,r.default)(t,s(e)+".scr")}),n.innerText="Download SCR"}return c.prepend(a),i}async function l(e,n,r){if(n.toUpperCase().endsWith(".SCR"))(0,t.pixelsForSCR)(e,a(n));else{const i=new Blob([e],{type:r}),c=URL.createObjectURL(i),s=await(0,o.dither)({url:c});console.log(s),(0,t.pixelsForSCR)(s,a(n,s)),URL.revokeObjectURL(c)}}(0,e.default)(document.body,l),(0,n.$)("input").on("change",e=>{const t=e.target.files[0],n=new FileReader;n.onload=(e=>l(new Uint8Array(e.target.result),t.name,t.type)),n.readAsArrayBuffer(t)});
},{"../lib/dnd.js":"L89o","./lib/scr.js":"Jezl","../lib/$.js":"FfSr","../lib/save.js":"iWCo","./lib/retrofy.js":"axyq"}]},{},["w5Xh"], null)
//# sourceMappingURL=/scr-tools.2d0b6445.js.map